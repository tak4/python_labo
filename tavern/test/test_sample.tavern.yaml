test_name: 簡単なテスト

includes:
  - !include ../include/includes.yaml

marks:
  - parametrize:
      key: param_val_name
      vals:
        - test user1
        - user user2

  - parametrize:
      key: param_val_age
      vals:
        - 20
        - 30

stages:
  - name: 200が返ってくるかどうかのテスト
    # skip: True    # ステージ単位でのSkip
    request:
      url: http://127.0.0.1:5000/items
      method: GET
    response:
      status_code: 200

  - name: jsonのテスト
    request:
      url: http://127.0.0.1:5000/items
      method: GET
    response:
      status_code: 200
      json:
        _id: !re_fullmatch "[-0-9a-z]+"
        index: !anything
        guid: !anything
        isActive: !anything
        balance: !anything
        picture: !anything
        # age: !anything
        age: !int "{var_age:d}"
        eyeColor: !anything
        # name: !anything
        name: !!str "{var_name:s}"
        gender: !anything
        company: !anything
        email: !anything
        phone: !anything
        address: !anything
        about: !anything
        registered: !anything
        latitude: !anything
        longitude: !anything
        tags: !anything
        friends: 
        - id: !anything
          etc: !anything

  - name: jsonのテスト(外部関数)
    # skip: True    # ステージ単位でのSkip
    request:
      url: http://127.0.0.1:5000/items
      method: GET
    response:
      status_code: 200
      verify_response_with:
        function: helper.testing_utils:is_specified_json
        extra_kwargs:
          schema: 
            name: "{var_name:s}"
            age: "{var_age:d}"

  - name: responseの保存
    # skip: True    # ステージ単位でのSkip
    request:
      url: http://127.0.0.1:5000/items
      method: GET
    response:
      status_code: 200
      verify_response_with:
        function: helper.testing_utils:save_response
        extra_kwargs:
          fname: response.txt

  - name: request変数
    # skip: True    # ステージ単位でのSkip
    request:
      url: http://127.0.0.1:5000/requestval?name="{param_val_name}"&age={param_val_age}
      method: GET
    response:
      status_code: 200
      verify_response_with:
        function: helper.testing_utils:save_response
        extra_kwargs:
          fname: requestval_{param_val_name}_{param_val_age}.txt
